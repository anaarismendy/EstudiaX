<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Calculadora de Estr√©s Acad√©mico</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        .fade-in { animation: fadeIn 0.4s ease-out forwards; }
        @keyframes fadeIn { from { opacity: 0; transform: scale(0.95); } to { opacity: 1; transform: scale(1); } }
        input:invalid { border-color: #f87171; }
    </style>
</head>
<body class="bg-gradient-to-br from-indigo-50 to-slate-200 min-h-screen flex items-center justify-center p-4">
    <div class="bg-white p-10 rounded-3xl shadow-2xl w-full max-w-md border border-slate-100">
        <header class="text-center mb-8">
            <h1 class="text-3xl font-extrabold text-slate-800">Evaluador de Estr√©s üß†</h1>
            <p id="instruccion" class="text-slate-500 text-sm mt-2">Completa todos los campos correctamente</p>
        </header>
        
        <div class="space-y-5">
            <div>
                <label class="block text-xs font-bold text-slate-500 uppercase mb-1">Horas de Sue√±o (0 a 12)</label>
                <input type="number" id="sueno" min="0" max="12" placeholder="Ej: 7" oninput="validarYCalcular()" 
                       class="w-full p-3 bg-slate-50 border-2 border-slate-200 rounded-xl focus:border-indigo-500 outline-none transition-all">
            </div>
            
            <div>
                <label class="block text-xs font-bold text-slate-500 uppercase mb-1">Carga Acad√©mica (1 a 10)</label>
                <input type="number" id="carga" min="1" max="10" placeholder="Ej: 5" oninput="validarYCalcular()" 
                       class="w-full p-3 bg-slate-50 border-2 border-slate-200 rounded-xl focus:border-indigo-500 outline-none transition-all">
            </div>
            
            <div>
                <label class="block text-xs font-bold text-slate-500 uppercase mb-1">Nivel de Ansiedad (0 a 10)</label>
                <input type="number" id="ansiedad" min="0" max="10" placeholder="Ej: 3" oninput="validarYCalcular()" 
                       class="w-full p-3 bg-slate-50 border-2 border-slate-200 rounded-xl focus:border-indigo-500 outline-none transition-all">
            </div>
        </div>

        <p id="errorMsg" class="text-rose-500 text-xs mt-4 font-bold text-center hidden">‚ö†Ô∏è Los valores est√°n fuera de rango</p>

        <div id="resultado" class="mt-8 hidden p-6 rounded-2xl text-center border-2 fade-in shadow-inner">
            <h2 id="nivelTxt" class="text-4xl font-black mb-1">-</h2>
            <div class="h-2 w-full bg-black/10 rounded-full overflow-hidden mb-2">
                <div id="progressBar" class="h-full bg-current transition-all duration-500" style="width: 0%"></div>
            </div>
            <p id="scoreTxt" class="text-lg font-bold"></p>
        </div>
    </div>

    <script>
        async function validarYCalcular() {
            const s = document.getElementById('sueno');
            const c = document.getElementById('carga');
            const a = document.getElementById('ansiedad');
            const resDiv = document.getElementById('resultado');
            const errorMsg = document.getElementById('errorMsg');

            // 1. Validar que no est√©n vac√≠os
            if (s.value === "" || c.value === "" || a.value === "") {
                resDiv.classList.add('hidden');
                errorMsg.classList.add('hidden');
                return;
            }

            // 2. Validar Rangos (Conversi√≥n a n√∫mero para comparar)
            const valS = parseFloat(s.value);
            const valC = parseFloat(c.value);
            const valA = parseFloat(a.value);

            const suenoOk = valS >= 0 && valS <= 12;
            const cargaOk = valC >= 1 && valC <= 10;
            const ansiedadOk = valA >= 0 && valA <= 10;

            if (!suenoOk || !cargaOk || !ansiedadOk) {
                resDiv.classList.add('hidden');
                errorMsg.classList.remove('hidden');
                return;
            }

            // Si todo est√° bien, ocultamos error y calculamos
            errorMsg.classList.add('hidden');

            try {
                const response = await fetch(`/evaluar?sueno=${valS}&carga=${valC}&ansiedad=${valA}`);
                const data = await response.json();
                
                resDiv.classList.remove('hidden', 'bg-emerald-50', 'bg-amber-50', 'bg-rose-50', 'border-emerald-200', 'border-amber-200', 'border-rose-200', 'text-emerald-800', 'text-amber-800', 'text-rose-800');
                
                if(data.nivel === "Bajo") resDiv.classList.add('bg-emerald-50', 'text-emerald-800', 'border-emerald-200');
                else if(data.nivel === "Moderado") resDiv.classList.add('bg-amber-50', 'text-amber-800', 'border-amber-200');
                else resDiv.classList.add('bg-rose-50', 'text-rose-800', 'border-rose-200');

                document.getElementById('nivelTxt').innerText = data.nivel.toUpperCase();
                document.getElementById('scoreTxt').innerText = `${data.score_estres}%`;
                document.getElementById('progressBar').style.width = `${data.score_estres}%`;

            } catch (e) {
                console.error("Error en la petici√≥n");
            }
        }
    </script>
</body>
</html>