<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Evaluador de Estr√©s Acad√©mico</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* Animaci√≥n de entrada con efecto rebote profesional */
        .fade-in-up { 
            animation: fadeInUp 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275) forwards; 
        }

        @keyframes fadeInUp { 
            from { 
                opacity: 0; 
                transform: translateY(20px) scale(0.95); 
            } 
            to { 
                opacity: 1; 
                transform: translateY(0) scale(1); 
            } 
        }
    </style>
</head>
<body class="bg-gradient-to-br from-indigo-50 to-slate-200 min-h-screen flex items-center justify-center p-4">
    <div class="bg-white p-10 rounded-3xl shadow-2xl w-full max-w-md border border-slate-100">
        <header class="text-center mb-8">
            <h1 class="text-3xl font-extrabold text-slate-800 tracking-tight">Evaluador de Estr√©s üß†</h1>
            <p class="text-slate-500 text-sm mt-1 font-medium">Diagn√≥stico instant√°neo</p>
        </header>
        
        <div class="space-y-5">
            <div>
                <label class="block text-[10px] font-bold text-slate-400 uppercase tracking-widest mb-1 ml-1">Horas de Sue√±o (0-12)</label>
                <input type="number" id="sueno" min="0" max="12" placeholder="Ej: 7" oninput="validarYCalcular()" 
                       class="w-full p-3 bg-slate-50 border-2 border-slate-100 rounded-2xl focus:border-indigo-500 outline-none transition-all">
            </div>
            
            <div>
                <label class="block text-[10px] font-bold text-slate-400 uppercase tracking-widest mb-1 ml-1">Carga Acad√©mica (1-10)</label>
                <input type="number" id="carga" min="1" max="10" placeholder="Ej: 5" oninput="validarYCalcular()" 
                       class="w-full p-3 bg-slate-50 border-2 border-slate-100 rounded-2xl focus:border-indigo-500 outline-none transition-all">
            </div>
            
            <div>
                <label class="block text-[10px] font-bold text-slate-400 uppercase tracking-widest mb-1 ml-1">Nivel de Ansiedad (0-10)</label>
                <input type="number" id="ansiedad" min="0" max="10" placeholder="Ej: 3" oninput="validarYCalcular()" 
                       class="w-full p-3 bg-slate-50 border-2 border-slate-100 rounded-2xl focus:border-indigo-500 outline-none transition-all">
            </div>
        </div>

        <p id="errorMsg" class="text-red-500 text-[10px] mt-4 font-bold text-center hidden uppercase tracking-widest animate-pulse">
            ‚ö†Ô∏è Valores fuera de rango
        </p>

        <div id="resultado" class="mt-8 hidden p-8 rounded-3xl text-center border-4 shadow-xl">
            <p class="text-[10px] uppercase tracking-[0.3em] font-bold opacity-70 mb-2">Resultado</p>
            <h2 id="nivelTxt" class="text-5xl font-black tracking-tighter">-</h2>
        </div>
    </div>

    <script>
        async function validarYCalcular() {
            const s = document.getElementById('sueno'), c = document.getElementById('carga'), a = document.getElementById('ansiedad');
            const resDiv = document.getElementById('resultado'), errorMsg = document.getElementById('errorMsg'), nivelTxt = document.getElementById('nivelTxt');

            // 1. Si los campos est√°n vac√≠os, ocultamos todo y salimos
            if (s.value === "" || c.value === "" || a.value === "") {
                resDiv.classList.add('hidden');
                errorMsg.classList.add('hidden');
                return;
            }

            // 2. Validar rangos num√©ricos
            const valS = parseFloat(s.value), valC = parseFloat(c.value), valA = parseFloat(a.value);
            const rangosOk = valS >= 0 && valS <= 12 && valC >= 1 && valC <= 10 && valA >= 0 && valA <= 10;

            if (!rangosOk) {
                resDiv.classList.add('hidden');
                errorMsg.classList.remove('hidden');
                return;
            }

            // Si llegamos aqu√≠, los datos son v√°lidos
            errorMsg.classList.add('hidden');

            try {
                const response = await fetch(`/evaluar?sueno=${valS}&carga=${valC}&ansiedad=${valA}`);
                const data = await response.json();
                
                // --- REINICIO AGRESIVO DE ANIMACI√ìN ---
                resDiv.classList.add('hidden'); // Ocultamos
                resDiv.classList.remove('fade-in-up'); // Quitamos animaci√≥n
                
                // Reiniciar clases de color (limpiamos todo)
                resDiv.className = "mt-8 p-8 rounded-3xl text-center border-4 shadow-xl";

                // Aplicar nuevos colores seg√∫n el nivel (SEM√ÅFORO)
                if(data.nivel === "Bajo" || data.nivel === "Leve") {
                    resDiv.classList.add('bg-emerald-500', 'text-white', 'border-emerald-600');
                } else if(data.nivel === "Moderado") {
                    resDiv.classList.add('bg-yellow-400', 'text-amber-900', 'border-yellow-500');
                } else {
                    resDiv.classList.add('bg-red-600', 'text-white', 'border-red-700');
                }

                nivelTxt.innerText = data.nivel.toUpperCase();

                setTimeout(() => {
                    resDiv.classList.remove('hidden');
                    resDiv.classList.add('fade-in-up');
                }, 10);

            } catch (e) { 
                console.error("Error al conectar con la API"); 
            }
        }
    </script>
</body>
</html>